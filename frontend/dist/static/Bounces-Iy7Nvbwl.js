import{V as n,m as r,n as o}from"./index-BCeMOe0T.js";import{E as c}from"./EmptyPlaceholder-C9_D_EHA.js";const u=n.extend({components:{EmptyPlaceholder:c},data(){return{bounces:{},bulk:{checked:[],all:!1},queryParams:{page:1,orderBy:"created_at",order:"desc",campaignID:0,source:""}}},methods:{onSort(a,e){this.queryParams.orderBy=a,this.queryParams.order=e,this.getBounces()},onPageChange(a){this.queryParams.page=a,this.getBounces()},selectAllBounces(){this.bulk.all=!0},onTableCheck(){this.bulk.checked.length!==this.bounces.total&&(this.bulk.all=!1)},getBounces(){this.bulk.checked=[],this.bulk.all=!1,this.$api.getBounces({page:this.queryParams.page,order_by:this.queryParams.orderBy,order:this.queryParams.order,campaign_id:this.queryParams.campaign_id,source:this.queryParams.source}).then(a=>{this.bounces=a})},deleteBounce(a){this.$api.deleteBounce(a.id).then(()=>{this.getBounces(),this.$utils.toast(this.$t("globals.messages.deleted",{name:a.email}))})},deleteBounces(){const a={};!this.bulk.all&&this.bulk.checked.length>0?a.id=this.bulk.checked.map(e=>e.id):this.bulk.all&&(a.all=!0),this.$api.deleteBounces(a).then(()=>{this.getBounces(),this.$utils.toast(this.$t("globals.messages.deletedCount",{name:this.$tc("globals.terms.bounces"),num:this.numSelectedBounces}))})},blocklistSubscribers(){const a=()=>{this.getBounces(),this.$utils.toast(this.$t("globals.messages.done"))};if(!this.bulk.all&&this.bulk.checked.length>0){const e=this.bulk.checked.map(t=>t.subscriberId);this.$api.blocklistSubscribers({ids:e}).then(a);return}this.$api.blocklistBouncedSubscribers({all:!0}).then(a)}},computed:{...r(["templates","loading"]),numSelectedBounces(){return this.bulk.all?this.bounces.total:this.bulk.checked.length}},mounted(){this.$route.query.campaign_id&&(this.queryParams.campaign_id=parseInt(this.$route.query.campaign_id,10)),this.$route.query.source&&(this.queryParams.source=this.$route.query.source),this.getBounces()}});var i=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("section",{staticClass:"bounces"},[t("header",{staticClass:"page-header columns"},[t("div",{staticClass:"column is-two-thirds"},[t("h1",{staticClass:"title is-4"},[e._v(" "+e._s(e.$t("globals.terms.bounces"))+" "),e.bounces.total>0?t("span",[e._v("("+e._s(e.bounces.total)+")")]):e._e()])])]),t("b-table",{attrs:{data:e.bounces.results,hoverable:!0,loading:e.loading.bounces,"default-sort":"createdAt",checkable:"","checked-rows":e.bulk.checked,detailed:"","show-detail-icon":"",paginated:"","backend-pagination":"","pagination-position":"both","current-page":e.queryParams.page,"per-page":e.bounces.perPage,total:e.bounces.total,"backend-sorting":""},on:{"check-all":e.onTableCheck,check:e.onTableCheck,"update:checkedRows":function(s){return e.$set(e.bulk,"checked",s)},"update:checked-rows":function(s){return e.$set(e.bulk,"checked",s)},"page-change":e.onPageChange,sort:e.onSort},scopedSlots:e._u([{key:"top-left",fn:function(){return[t("div",{staticClass:"actions"},[e.bulk.checked.length>0?[t("a",{staticClass:"a",attrs:{href:"#","data-cy":"btn-delete"},on:{click:function(s){s.preventDefault(),e.$utils.confirm(null,()=>e.deleteBounces())}}},[t("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}}),e._v(" "+e._s(e.$t("globals.buttons.delete"))+" ")],1),t("a",{staticClass:"a",attrs:{href:"#","data-cy":"btn-manage-blocklist"},on:{click:function(s){s.preventDefault(),e.$utils.confirm(null,()=>e.blocklistSubscribers())}}},[t("b-icon",{attrs:{icon:"account-off-outline",size:"is-small"}}),e._v(" "+e._s(e.$t("import.blocklist"))+" ")],1),t("span",[e._v(" "+e._s(e.$t("globals.messages.numSelected",{num:e.numSelectedBounces}))+" "),!e.bulk.all&&e.bounces.total>e.bounces.perPage?t("span",[e._v(" â€” "),t("a",{attrs:{href:"#"},on:{click:function(s){return s.preventDefault(),e.selectAllBounces.apply(null,arguments)}}},[e._v(" "+e._s(e.$t("subscribers.selectAll",{num:e.bounces.total}))+" ")])]):e._e()])]:e._e()],2)]},proxy:!0},{key:"detail",fn:function(s){return[t("pre",{staticClass:"is-size-7"},[e._v(e._s(s.row.meta))])]}},e.loading.templates?null:{key:"empty",fn:function(){return[t("empty-placeholder")]},proxy:!0}],null,!0)},[t("b-table-column",{attrs:{field:"email",label:e.$t("subscribers.email"),"td-attrs":e.$utils.tdID,sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[t("router-link",{class:{blocklisted:s.row.subscriberStatus==="blocklisted"},attrs:{to:{name:"subscriber",params:{id:s.row.subscriberId}}}},[e._v(" "+e._s(s.row.email)+" "),s.row.subscriberStatus!=="enabled"?t("b-tag",{class:s.row.subscriberStatus,attrs:{"data-cy":"blocklisted"}},[e._v(" "+e._s(e.$t(`subscribers.status.${s.row.subscriberStatus}`))+" ")]):e._e()],1)]}}])}),t("b-table-column",{attrs:{field:"campaign",label:e.$tc("globals.terms.campaign"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[s.row.campaign?t("router-link",{attrs:{to:{name:"bounces",query:{campaign_id:s.row.campaign.id}}}},[e._v(" "+e._s(s.row.campaign.name)+" ")]):t("span",[e._v("-")])]}}])}),t("b-table-column",{attrs:{field:"source",label:e.$t("bounces.source"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[t("router-link",{attrs:{to:{name:"bounces",query:{source:s.row.source}}}},[e._v(" "+e._s(s.row.source)+" ")])]}}])}),t("b-table-column",{attrs:{field:"type",label:e.$t("globals.fields.type"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[t("router-link",{attrs:{to:{name:"bounces",query:{type:s.row.type}}}},[e._v(" "+e._s(e.$t(`bounces.${s.row.type}`))+" ")])]}}])}),t("b-table-column",{attrs:{field:"created_at",label:e.$t("globals.fields.createdAt"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(s){return[e._v(" "+e._s(e.$utils.niceDate(s.row.createdAt,!0))+" ")]}}])}),t("b-table-column",{attrs:{"cell-class":"actions",align:"right"},scopedSlots:e._u([{key:"default",fn:function(s){return[t("div",[s.row.isDefault?t("span",{staticClass:"a has-text-grey-light"},[t("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1):t("a",{attrs:{href:"#","data-cy":"btn-delete","aria-label":e.$t("globals.buttons.delete")},on:{click:function(l){l.preventDefault(),e.$utils.confirm(null,()=>e.deleteBounce(s.row))}}},[t("b-tooltip",{attrs:{label:e.$t("globals.buttons.delete"),type:"is-dark"}},[t("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1)])]}}])})],1)],1)},b=[],d=o(u,i,b);const f=d.exports;export{f as default};
