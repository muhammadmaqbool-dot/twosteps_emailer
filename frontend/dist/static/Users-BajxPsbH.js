import{V as i,m as o,n as l}from"./index-BCeMOe0T.js";import{E as n}from"./EmptyPlaceholder-C9_D_EHA.js";import{C as d}from"./CopyText-Da2spgK4.js";const u=i.extend({name:"UserForm",components:{CopyText:d},props:{data:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1}},data(){return{form:{username:"",email:"",name:"",password:"",passwordLogin:!1,type:"user",status:"enabled"},apiToken:null}},methods:{onSubmit(){if(this.form.passwordLogin||(this.form.password=null,this.form.password2=null),this.isEditing){if(this.form.type!=="api"&&this.form.passwordLogin&&this.form.password&&this.form.password!==this.form.password2){this.$utils.toast(this.$t("users.passwordMismatch"),"is-danger");return}this.updateUser();return}if(this.form.type!=="api"&&this.form.passwordLogin&&this.form.password!==this.form.password2){this.$utils.toast(this.$t("users.passwordMismatch"),"is-danger");return}this.createUser()},createUser(){const a={...this.form,password_login:this.form.passwordLogin,user_role_id:this.form.userRoleId,list_role_id:this.form.listRoleId||null};this.$api.createUser(a).then(s=>{if(this.$emit("finished"),this.$utils.toast(this.$t("globals.messages.created",{name:s.name})),a.type==="api"){this.apiToken=s.password;return}this.$emit("finished"),this.$parent.close()})},updateUser(){const a={...this.form,password_login:this.form.passwordLogin,user_role_id:this.form.userRoleId,list_role_id:this.form.listRoleId||null};this.$api.updateUser({id:this.data.id,...a}).then(s=>{this.$emit("finished"),this.$parent.close(),this.$utils.toast(this.$t("globals.messages.updated",{name:s.name}))})},hasType(a){return!this.$props.isEditing||(this.form.type==="api"?a==="api":a!=="api")}},computed:{...o(["loading","userRoles","listRoles"])},mounted(){this.form={...this.form,...this.$props.data},this.$props.data.userRole&&(this.form.userRoleId=this.$props.data.userRole.id),this.form.listRoleId=this.$props.data.listRole?this.$props.data.listRole.id:"",this.$api.getUserRoles(),this.$api.getListRoles(),this.$nextTick(()=>{this.$refs.focus.focus()})}});var c=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("form",{on:{submit:function(t){return t.preventDefault(),s.onSubmit.apply(null,arguments)}}},[e("div",{staticClass:"modal-card content",staticStyle:{width:"auto"}},[e("header",{staticClass:"modal-card-head"},[s.isEditing?e("p",{staticClass:"has-text-grey-light is-size-7"},[s._v(" "+s._s(s.$t("globals.fields.id"))+": "),e("copy-text",{attrs:{text:`${s.data.id}`}})],1):s._e(),s.isEditing?e("h4",[s._v(" "+s._s(s.data.name)+" ")]):e("h4",[s._v(" "+s._s(s.$t("users.newUser"))+" ")])]),e("section",{staticClass:"modal-card-body",attrs:{expanded:""}},[e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-6"},[e("b-field",{staticClass:"mb-6",attrs:{"label-position":"on-border"}},[e("b-radio-button",{attrs:{name:"type","native-value":"user",disabled:s.isEditing,expanded:"",type:"is-light is-outlined"},model:{value:s.form.type,callback:function(t){s.$set(s.form,"type",t)},expression:"form.type"}},[e("b-icon",{attrs:{icon:"account-outline"}}),s._v(" "+s._s(s.$t("users.type.user"))+" ")],1),e("b-radio-button",{attrs:{name:"type","native-value":"api",disabled:s.isEditing,expanded:"",type:"is-light is-outlined"},model:{value:s.form.type,callback:function(t){s.$set(s.form,"type",t)},expression:"form.type"}},[e("b-icon",{attrs:{icon:"code"}}),s._v(" "+s._s(s.$t("users.type.api"))+" ")],1)],1)],1),e("div",{staticClass:"column is-6"},[e("b-field",{attrs:{label:s.$t("globals.fields.status"),"label-position":"on-border"}},[e("b-select",{attrs:{name:"status",required:"",expanded:""},model:{value:s.form.status,callback:function(t){s.$set(s.form,"status",t)},expression:"form.status"}},[e("option",{attrs:{value:"enabled"}},[s._v(" "+s._s(s.$t("users.status.enabled"))+" ")]),e("option",{attrs:{value:"disabled"}},[s._v(" "+s._s(s.$t("users.status.disabled"))+" ")])])],1)],1)]),e("b-field",{attrs:{label:s.$t("users.username"),"label-position":"on-border"}},[e("b-input",{ref:"focus",attrs:{maxlength:200,name:"username",autofocus:"",placeholder:s.$t("users.username"),required:"",message:s.$t("users.usernameHelp"),autocomplete:"off",pattern:"[a-zA-Z0-9_\\-\\.@]+$"},model:{value:s.form.username,callback:function(t){s.$set(s.form,"username",t)},expression:"form.username"}})],1),e("b-field",{attrs:{label:s.$t("globals.fields.name"),"label-position":"on-border"}},[e("b-input",{attrs:{maxlength:200,name:"name",placeholder:s.$t("globals.fields.name")},model:{value:s.form.name,callback:function(t){s.$set(s.form,"name",t)},expression:"form.name"}})],1),s.form.type!=="api"?e("b-field",{attrs:{label:s.$t("subscribers.email"),"label-position":"on-border"}},[e("b-input",{attrs:{maxlength:200,name:"email",placeholder:s.$t("subscribers.email"),required:""},model:{value:s.form.email,callback:function(t){s.$set(s.form,"email",t)},expression:"form.email"}})],1):s._e(),s.form.type!=="api"?[e("div",{staticClass:"box"},[e("b-field",[e("b-checkbox",{attrs:{"native-value":!0,name:"password_login"},model:{value:s.form.passwordLogin,callback:function(t){s.$set(s.form,"passwordLogin",t)},expression:"form.passwordLogin"}},[s._v(" "+s._s(s.$t("users.passwordEnable"))+" ")])],1),e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-6"},[e("b-field",{attrs:{label:s.$t("users.password"),"label-position":"on-border"}},[e("b-input",{attrs:{disabled:!s.form.passwordLogin,minlength:"8",maxlength:200,type:"password",name:"password",placeholder:s.$t("users.password"),required:s.form.passwordLogin&&!s.isEditing},model:{value:s.form.password,callback:function(t){s.$set(s.form,"password",t)},expression:"form.password"}})],1)],1),e("div",{staticClass:"column is-6"},[e("b-field",{attrs:{label:s.$t("users.passwordRepeat"),"label-position":"on-border"}},[e("b-input",{attrs:{disabled:!s.form.passwordLogin,minlength:"8",maxlength:200,type:"password",name:"password2",required:s.form.passwordLogin&&!s.isEditing&&s.form.password},model:{value:s.form.password2,callback:function(t){s.$set(s.form,"password2",t)},expression:"form.password2"}})],1)],1)])],1)]:s._e(),e("h5",[s._v(s._s(s.$tc("users.roles")))]),e("div",{staticClass:"box"},[e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-6"},[e("b-field",{attrs:{label:s.$tc("users.userRole"),"label-position":"on-border"}},[e("b-select",{attrs:{name:"user_role",required:"",expanded:""},model:{value:s.form.userRoleId,callback:function(t){s.$set(s.form,"userRoleId",t)},expression:"form.userRoleId"}},s._l(s.userRoles,function(t){return e("option",{key:t.id,domProps:{value:t.id}},[s._v(" "+s._s(t.name)+" ")])}),0)],1)],1),e("div",{staticClass:"column is-6"},[e("b-field",{attrs:{label:s.$tc("users.listRole",0),"label-position":"on-border"}},[e("b-select",{attrs:{name:"list_role",expanded:""},model:{value:s.form.listRoleId,callback:function(t){s.$set(s.form,"listRoleId",t)},expression:"form.listRoleId"}},[e("option",{attrs:{value:""}},[s._v("— "+s._s(s.$t("globals.terms.none"))+" —")]),s._l(s.listRoles,function(t){return e("option",{key:t.id,domProps:{value:t.id}},[s._v(" "+s._s(t.name)+" ")])})],2)],1)],1)])]),s.apiToken?e("div",{staticClass:"user-api-token"},[e("p",[s._v(s._s(s.$t("users.apiOneTimeToken")))]),e("copy-text",{attrs:{text:s.apiToken}})],1):s._e()],2),e("footer",{staticClass:"modal-card-foot has-text-right"},[e("b-button",{on:{click:function(t){return s.$parent.close()}}},[s._v(" "+s._s(s.$t("globals.buttons.close"))+" ")]),s.$can("users:manage")&&!s.apiToken?e("b-button",{attrs:{"native-type":"submit",type:"is-primary",loading:s.loading.lists,"data-cy":"btn-save"}},[s._v(" "+s._s(s.$t("globals.buttons.save"))+" ")]):s._e()],1)])])},m=[],p=l(u,c,m);const f=p.exports,b=i.extend({components:{EmptyPlaceholder:n,UserForm:f},data(){return{curItem:null,isEditing:!1,isFormVisible:!1,users:[],checked:[],queryParams:{page:1,query:"",orderBy:"id",order:"asc"}}},methods:{onSort(a,s){this.queryParams.orderBy=a,this.queryParams.order=s,this.getUsers()},onTableCheck(){this.bulk.checked.length!==this.subscribers.total&&(this.bulk.all=!1)},showEditForm(a){this.curItem=a,this.isFormVisible=!0,this.isEditing=!0},showNewForm(){this.curItem={},this.isFormVisible=!0,this.isEditing=!1},formFinished(){this.getUsers()},onFormClose(){this.$route.params.id&&this.$router.push({name:"users"})},getUsers(){this.$api.queryUsers({query:this.queryParams.query.replace(/[^\p{L}\p{N}\s]/gu," "),order_by:this.queryParams.orderBy,order:this.queryParams.order}).then(a=>{this.users=a})},deleteUser(a){this.$utils.confirm(this.$t("globals.messages.confirm"),()=>{this.$api.deleteUser(a.id).then(()=>{this.getUsers(),this.$utils.toast(this.$t("globals.messages.deleted",{name:a.name}))})})}},computed:{...o(["loading","settings"])},mounted(){this.$route.params.id?this.$api.getUser(parseInt(this.$route.params.id,10)).then(a=>{this.showEditForm(a)}):this.getUsers()}});var h=function(){var s=this,e=s._self._c;return s._self._setupProxy,e("section",{staticClass:"users"},[e("header",{staticClass:"columns page-header"},[e("div",{staticClass:"column is-10"},[e("h1",{staticClass:"title is-4"},[s._v(" "+s._s(s.$t("globals.terms.users"))+" "),isNaN(s.users.length)?s._e():e("span",[s._v("("+s._s(s.users.length)+")")])])]),e("div",{staticClass:"column has-text-right"},[s.$can("users:manage")?e("b-field",{attrs:{expanded:""}},[e("b-button",{staticClass:"btn-new",attrs:{expanded:"",type:"is-primary","icon-left":"plus","data-cy":"btn-new"},on:{click:s.showNewForm}},[s._v(" "+s._s(s.$t("globals.buttons.new"))+" ")])],1):s._e()],1)]),e("b-table",{attrs:{data:s.users,loading:s.loading.users,hoverable:"",checkable:"","checked-rows":s.checked,"default-sort":"createdAt","backend-sorting":""},on:{"update:checkedRows":function(t){s.checked=t},"update:checked-rows":function(t){s.checked=t},sort:s.onSort,"check-all":s.onTableCheck,check:s.onTableCheck},scopedSlots:s._u([{key:"top-left",fn:function(){return[e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-6"},[e("form",{on:{submit:function(t){return t.preventDefault(),s.getUsers.apply(null,arguments)}}},[e("div",[e("b-field",[e("b-input",{ref:"query",attrs:{name:"query",expanded:"",icon:"magnify","data-cy":"query"},model:{value:s.queryParams.query,callback:function(t){s.$set(s.queryParams,"query",t)},expression:"queryParams.query"}}),e("p",{staticClass:"controls"},[e("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify","data-cy":"btn-query"}})],1)],1)],1)])])])]},proxy:!0},s.loading.users?null:{key:"empty",fn:function(){return[e("empty-placeholder")]},proxy:!0}],null,!0)},[e("b-table-column",{attrs:{field:"username",label:s.$t("users.username"),"header-class":"cy-username",sortable:"","td-attrs":s.$utils.tdID},scopedSlots:s._u([{key:"default",fn:function(t){return[e("a",{class:{"has-text-grey":t.row.status==="disabled"},attrs:{href:`/users/${t.row.id}`},on:{click:function(r){return r.preventDefault(),s.showEditForm(t.row)}}},[s._v(" "+s._s(t.row.username)+" ")]),t.row.status==="disabled"?e("b-tag",[s._v(" "+s._s(s.$t(`users.status.${t.row.status}`))+" ")]):s._e(),t.row.type==="api"?e("b-tag",{staticClass:"api"},[e("b-icon",{attrs:{icon:"code"}}),s._v(" "+s._s(s.$t(`users.type.${t.row.type}`))+" ")],1):s._e(),e("div",{staticClass:"has-text-grey is-size-7 mt-2"},[s._v(" "+s._s(t.row.name)+" ")])]}}])}),e("b-table-column",{attrs:{field:"status",label:s.$tc("users.role"),"header-class":"cy-status",sortable:"","td-attrs":s.$utils.tdID},scopedSlots:s._u([{key:"default",fn:function(t){return[e("router-link",{attrs:{to:{name:"userRoles"}}},[e("b-tag",{class:t.row.userRole.id===1?"enabled":"primary"},[e("b-icon",{attrs:{icon:"account-outline"}}),s._v(" "+s._s(t.row.userRole.name)+" ")],1)],1),e("router-link",{attrs:{to:{name:"listRoles"}}},[t.row.listRole?e("b-tag",[e("b-icon",{attrs:{icon:"newspaper-variant-outline"}}),s._v(" "+s._s(t.row.listRole.name)+" ")],1):s._e()],1)]}}])}),e("b-table-column",{attrs:{field:"name",label:s.$t("subscribers.email"),"header-class":"cy-name",sortable:"","td-attrs":s.$utils.tdID},scopedSlots:s._u([{key:"default",fn:function(t){return[e("div",[t.row.email?e("a",{class:{"has-text-grey":t.row.status==="disabled"},attrs:{href:`/users/${t.row.id}`},on:{click:function(r){return r.preventDefault(),s.showEditForm(t.row)}}},[s._v(" "+s._s(t.row.email)+" ")]):[s._v(" — ")]],2)]}}])}),e("b-table-column",{attrs:{field:"created_at",label:s.$t("globals.fields.createdAt"),"header-class":"cy-created_at",sortable:""},scopedSlots:s._u([{key:"default",fn:function(t){return[s._v(" "+s._s(s.$utils.niceDate(t.row.createdAt))+" ")]}}])}),e("b-table-column",{attrs:{field:"updated_at",label:s.$t("globals.fields.updatedAt"),"header-class":"cy-updated_at",sortable:""},scopedSlots:s._u([{key:"default",fn:function(t){return[s._v(" "+s._s(s.$utils.niceDate(t.row.updatedAt))+" ")]}}])}),e("b-table-column",{attrs:{field:"last_login",label:s.$t("users.lastLogin"),"header-class":"cy-updated_at",sortable:""},scopedSlots:s._u([{key:"default",fn:function(t){return[s._v(" "+s._s(t.row.loggedinAt?s.$utils.niceDate(t.row.loggedinAt,!0):"—")+" ")]}}])}),e("b-table-column",{attrs:{"cell-class":"actions",align:"right"},scopedSlots:s._u([{key:"default",fn:function(t){return[e("div",[s.$can("users:manage")?e("a",{attrs:{href:"#","data-cy":"btn-edit","aria-label":s.$t("globals.buttons.edit")},on:{click:function(r){return r.preventDefault(),s.showEditForm(t.row)}}},[e("b-tooltip",{attrs:{label:s.$t("globals.buttons.edit"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"pencil-outline",size:"is-small"}})],1)],1):s._e(),s.$can("users:manage")?e("a",{attrs:{href:"#","data-cy":"btn-delete","aria-label":s.$t("globals.buttons.delete")},on:{click:function(r){return r.preventDefault(),s.deleteUser(t.row)}}},[e("b-tooltip",{attrs:{label:s.$t("globals.buttons.delete"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1):s._e()])]}}])})],1),e("b-modal",{attrs:{scroll:"keep","aria-modal":!0,active:s.isFormVisible,width:600},on:{"update:active":function(t){s.isFormVisible=t},close:s.onFormClose}},[e("user-form",{attrs:{data:s.curItem,"is-editing":s.isEditing},on:{finished:s.formFinished}})],1)],1)},_=[],g=l(b,h,_);const w=g.exports;export{w as default};
