import{V as l,m as o,n}from"./index-BCeMOe0T.js";import{E as r}from"./EmptyPlaceholder-C9_D_EHA.js";const d=l.extend({components:{EmptyPlaceholder:r},name:"Media",props:{isModal:Boolean,type:{type:String,default:""}},data(){return{form:{files:[]},toUpload:0,uploaded:0,showUploadForm:!1,queryParams:{page:1,query:""}}},methods:{removeUploadFile(s){this.form.files.splice(s,1)},getMedia(){this.$api.getMedia({page:this.queryParams.page,query:this.queryParams.query})},onToggleForm(){this.showUploadForm=!this.showUploadForm,this.$utils.setPref("media.upload",this.showUploadForm)},onQueryMedia(){this.queryParams.page=1,this.getMedia()},onMediaSelect(s,e){this.isModal&&(e.preventDefault(),this.$emit("selected",s),this.$parent.close())},onSubmit(){this.toUpload=this.form.files.length;for(let s=0;s<this.toUpload;s+=1){const e=new FormData;e.set("file",this.form.files[s]),this.$api.uploadMedia(e).then(()=>{this.onUploaded()},()=>{this.onUploaded()})}},onDeleteMedia(s){this.$api.deleteMedia(s).then(()=>{this.getMedia()})},onUploaded(){this.uploaded+=1,this.uploaded>=this.toUpload&&(this.toUpload=0,this.uploaded=0,this.form.files=[],this.getMedia())},onPageChange(s){this.queryParams.page=s,this.getMedia()}},computed:{...o(["loading","media","settings"]),isProcessing(){return this.toUpload>0&&this.uploaded<this.toUpload}},mounted(){this.$api.getSettings(),this.$api.getMedia(),this.$utils.getPref("media.upload")&&(this.showUploadForm=!0)}});var p=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("section",{staticClass:"media-files"},[t("h1",{staticClass:"title is-4"},[e._v(" "+e._s(e.$t("media.title"))+" "),e.media.results&&e.media.results.length>0?t("span",[e._v("("+e._s(e.media.results.length)+")")]):e._e(),t("span",{staticClass:"has-text-grey-light"},[e._v(" / "+e._s(e.settings["upload.provider"]))])]),t("b-loading",{attrs:{active:e.isProcessing||e.loading.media}}),t("section",{staticClass:"wrap gallery mt-6"},[t("div",{staticClass:"columns mb-4"},[t("div",{staticClass:"column"},[t("form",{staticClass:"search",on:{submit:function(a){return a.preventDefault(),e.onQueryMedia.apply(null,arguments)}}},[t("div",[t("b-field",[t("b-input",{ref:"query",attrs:{name:"query",expanded:"",icon:"magnify","data-cy":"query"},model:{value:e.queryParams.query,callback:function(a){e.$set(e.queryParams,"query",a)},expression:"queryParams.query"}}),t("p",{staticClass:"controls"},[t("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify","data-cy":"btn-query"}})],1)],1)],1)])]),t("div",{staticClass:"column is-narrow"},[t("b-button",{attrs:{"icon-left":"file-upload-outline","data-cy":"btn-toggle-upload"},on:{click:e.onToggleForm}},[e._v(" "+e._s(e.$t("media.upload"))+" ")])],1)]),t("b-collapse",{attrs:{animation:""},model:{value:e.showUploadForm,callback:function(a){e.showUploadForm=a},expression:"showUploadForm"}},[t("form",{staticClass:"mb-6",attrs:{"data-cy":"upload"},on:{submit:function(a){return a.preventDefault(),e.onSubmit.apply(null,arguments)}}},[t("div",[t("b-field",{attrs:{label:e.$t("media.upload")}},[t("b-upload",{attrs:{"drag-drop":"",multiple:"",xaccept:".png,.jpg,.jpeg,.gif,.svg",expanded:""},model:{value:e.form.files,callback:function(a){e.$set(e.form,"files",a)},expression:"form.files"}},[t("div",{staticClass:"has-text-centered section"},[t("p",[t("b-icon",{attrs:{icon:"file-upload-outline",size:"is-large"}})],1),t("p",[e._v(e._s(e.$t("media.uploadHelp")))])])])],1),e.form.files.length>0?t("div",{staticClass:"tags"},e._l(e.form.files,function(a,i){return t("b-tag",{key:i,attrs:{size:"is-medium",closable:""},on:{close:function(m){return e.removeUploadFile(i)}}},[e._v(" "+e._s(a.name)+" ")])}),1):e._e(),t("div",{staticClass:"buttons"},[t("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"file-upload-outline",disabled:e.form.files.length===0,loading:e.isProcessing}},[e._v(" "+e._s(e.$tc("media.upload"))+" ")])],1)],1)])]),e.media.total>e.media.perPage?t("div",{staticClass:"pagination-wrapper mt-5"},[t("b-pagination",{attrs:{total:e.media.total,current:e.media.page,"per-page":e.media.perPage},on:{"update:current":function(a){return e.$set(e.media,"page",a)},change:e.onPageChange}})],1):e._e(),e.loading.media?t("div",{staticClass:"has-text-centered py-6"},[t("b-loading",{attrs:{active:e.loading.media}})],1):e.media.results&&e.media.results.length>0?t("div",{staticClass:"grid"},e._l(e.media.results,function(a){return t("div",{key:a.id,staticClass:"item"},[t("div",{staticClass:"thumb"},[t("a",{staticClass:"thumb-link",attrs:{href:a.url,target:"_blank",rel:"noopener noreferer"},on:{click:i=>e.onMediaSelect(a,i)}},[t("div",{staticClass:"thumb-container"},[a.thumbUrl?t("img",{attrs:{src:a.thumbUrl,title:a.filename,alt:a.filename}}):t("div",{staticClass:"thumb-placeholder"},[t("span",{staticClass:"file-ext"},[e._v(" "+e._s(a.filename.split(".").pop().toUpperCase())+" ")])])])]),t("div",{staticClass:"actions"},[t("a",{staticClass:"delete-btn",attrs:{href:"#","data-cy":"btn-delete","aria-label":e.$t("globals.buttons.delete")},on:{click:function(i){i.preventDefault(),e.$utils.confirm(null,()=>e.onDeleteMedia(a.id))}}},[t("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)])]),t("div",{staticClass:"info"},[t("p",{staticClass:"filename",attrs:{title:a.filename}},[e._v(e._s(a.filename))]),t("p",{staticClass:"date"},[e._v(e._s(e.$utils.niceDate(a.createdAt,!1)))])])])}),0):e.loading.media?e._e():t("div",[t("empty-placeholder")],1),e.media.total>e.media.perPage?t("div",{staticClass:"pagination-wrapper mt-5"},[t("b-pagination",{attrs:{total:e.media.total,current:e.media.page,"per-page":e.media.perPage},on:{"update:current":function(a){return e.$set(e.media,"page",a)},change:e.onPageChange}})],1):e._e()],1)],1)},u=[],c=n(d,p,u);const h=c.exports;export{h as default};
