import{V as n,m as r,n as o}from"./index-BCeMOe0T.js";import{E as c}from"./EmptyPlaceholder-C9_D_EHA.js";import{C as d}from"./CopyText-Da2spgK4.js";const u=n.extend({name:"ListForm",components:{CopyText:d},props:{data:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1}},data(){return{form:{name:"",type:"private",optin:"single",tags:[]}}},methods:{onSubmit(){if(this.isEditing){this.updateList();return}this.createList()},createList(){this.$api.createList(this.form).then(a=>{this.$emit("finished"),this.$parent.close(),this.$utils.toast(this.$t("globals.messages.created",{name:a.name}))})},updateList(){this.$api.updateList({id:this.data.id,...this.form}).then(a=>{this.$emit("finished"),this.$parent.close(),this.$utils.toast(this.$t("globals.messages.updated",{name:a.name}))})}},computed:{...r(["loading","profile"])},mounted(){this.form={...this.form,...this.$props.data},this.$nextTick(()=>{this.$refs.focus.focus()})}});var m=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("form",{on:{submit:function(s){return s.preventDefault(),t.onSubmit.apply(null,arguments)}}},[e("div",{staticClass:"modal-card content",staticStyle:{width:"auto"}},[e("header",{staticClass:"modal-card-head"},[t.isEditing?e("p",{staticClass:"has-text-grey-light is-size-7"},[t._v(" "+t._s(t.$t("globals.fields.id"))+": "),e("copy-text",{attrs:{text:`${t.data.id}`}}),t._v(" "+t._s(t.$t("globals.fields.uuid"))+": "),e("copy-text",{attrs:{text:t.data.uuid}})],1):t._e(),t.isEditing?e("b-tag",{class:[t.data.type,"is-pulled-right"]},[t._v(" "+t._s(t.$t(`lists.types.${t.data.type}`))+" ")]):t._e(),t.isEditing?e("h4",[t._v(" "+t._s(t.data.name)+" ")]):e("h4",[t._v(" "+t._s(t.$t("lists.newList"))+" ")])],1),e("section",{staticClass:"modal-card-body",attrs:{expanded:""}},[e("b-field",{attrs:{label:t.$t("globals.fields.name"),"label-position":"on-border"}},[e("b-input",{ref:"focus",attrs:{maxlength:200,name:"name",placeholder:t.$t("globals.fields.name"),required:""},model:{value:t.form.name,callback:function(s){t.$set(t.form,"name",s)},expression:"form.name"}})],1),e("b-field",{attrs:{label:t.$t("lists.type"),"label-position":"on-border",message:t.$t("lists.typeHelp")}},[e("b-select",{attrs:{name:"type",placeholder:t.$t("lists.typeHelp"),required:"",expanded:""},model:{value:t.form.type,callback:function(s){t.$set(t.form,"type",s)},expression:"form.type"}},[e("option",{attrs:{value:"private"}},[t._v(" "+t._s(t.$t("lists.types.private"))+" ")]),e("option",{attrs:{value:"public"}},[t._v(" "+t._s(t.$t("lists.types.public"))+" ")])])],1),e("b-field",{attrs:{label:t.$t("lists.optin"),"label-position":"on-border",message:t.$t("lists.optinHelp")}},[e("b-select",{attrs:{name:"optin",placeholder:"Opt-in type",required:"",expanded:""},model:{value:t.form.optin,callback:function(s){t.$set(t.form,"optin",s)},expression:"form.optin"}},[e("option",{attrs:{value:"single"}},[t._v(" "+t._s(t.$t("lists.optins.single"))+" ")]),e("option",{attrs:{value:"double"}},[t._v(" "+t._s(t.$t("lists.optins.double"))+" ")])])],1),e("b-field",{attrs:{label:t.$t("globals.terms.tags"),"label-position":"on-border"}},[e("b-taginput",{attrs:{name:"tags",ellipsis:"",icon:"tag-outline",placeholder:t.$t("globals.terms.tags")},model:{value:t.form.tags,callback:function(s){t.$set(t.form,"tags",s)},expression:"form.tags"}})],1),e("b-field",{attrs:{label:t.$t("globals.fields.description"),"label-position":"on-border"}},[e("b-input",{attrs:{maxlength:2e3,name:"description",type:"textarea",placeholder:t.$t("globals.fields.description")},model:{value:t.form.description,callback:function(s){t.$set(t.form,"description",s)},expression:"form.description"}})],1)],1),e("footer",{staticClass:"modal-card-foot has-text-right"},[e("b-button",{on:{click:function(s){return t.$parent.close()}}},[t._v(" "+t._s(t.$t("globals.buttons.close"))+" ")]),t.$can("lists:manage_all")||t.$canList(t.data.id,"list:manage")?e("b-button",{attrs:{"native-type":"submit",type:"is-primary",loading:t.loading.lists,"data-cy":"btn-save"}},[t._v(" "+t._s(t.$t("globals.buttons.save"))+" ")]):t._e()],1)])])},p=[],b=o(u,m,p);const f=b.exports,g=n.extend({components:{ListForm:f,EmptyPlaceholder:c},data(){return{curItem:null,isEditing:!1,isFormVisible:!1,lists:[],queryParams:{page:1,query:"",orderBy:"id",order:"asc"}}},methods:{onPageChange(a){this.queryParams.page=a,this.getLists()},onSort(a,t){this.queryParams.orderBy=a,this.queryParams.order=t,this.getLists()},showEditForm(a){this.curItem=a,this.isFormVisible=!0,this.isEditing=!0},showNewForm(){this.curItem={},this.isFormVisible=!0,this.isEditing=!1},formFinished(){this.getLists()},onFormClose(){this.$route.params.id&&this.$router.push({name:"lists"})},filterStatuses(a){const t={...a.subscriberStatuses};return a.optin==="single"&&(delete t.unconfirmed,delete t.confirmed),t},getLists(){this.$api.queryLists({page:this.queryParams.page,query:this.queryParams.query.replace(/[^\p{L}\p{N}\s]/gu," "),order_by:this.queryParams.orderBy,order:this.queryParams.order}).then(a=>{this.lists=a}),this.$api.getLists({minimal:!0,per_page:"all"})},deleteList(a){this.$utils.confirm(this.$t("lists.confirmDelete"),()=>{this.$api.deleteList(a.id).then(()=>{this.getLists(),this.$utils.toast(this.$t("globals.messages.deleted",{name:a.name}))})})},createOptinCampaign(a){const t={name:this.$t("lists.optinTo",{name:a.name}),subject:this.$t("lists.confirmSub",{name:a.name}),lists:[a.id],from_email:this.settings["app.from_email"],content_type:"richtext",messenger:"email",type:"optin"};return this.$api.createCampaign(t).then(e=>{this.$router.push({name:"campaign",hash:"#content",params:{id:e.id}})}),!1}},computed:{...r(["loading","settings"])},mounted(){this.$route.params.id?this.$api.getList(parseInt(this.$route.params.id,10)).then(a=>{this.showEditForm(a)}):this.getLists()}});var h=function(){var t=this,e=t._self._c;return t._self._setupProxy,e("section",{staticClass:"lists"},[e("header",{staticClass:"columns page-header"},[e("div",{staticClass:"column is-10"},[e("h1",{staticClass:"title is-4"},[t._v(" "+t._s(t.$t("globals.terms.lists"))+" "),isNaN(t.lists.total)?t._e():e("span",[t._v("("+t._s(t.lists.total)+")")])])]),e("div",{staticClass:"column has-text-right"},[t.$can("lists:manage_all")?e("b-field",{attrs:{expanded:""}},[e("b-button",{staticClass:"btn-new",attrs:{expanded:"",type:"is-primary","icon-left":"plus","data-cy":"btn-new"},on:{click:t.showNewForm}},[t._v(" "+t._s(t.$t("globals.buttons.new"))+" ")])],1):t._e()],1)]),e("b-table",{attrs:{data:t.lists.results,loading:t.loading.listsFull,hoverable:"","default-sort":"createdAt",paginated:"","backend-pagination":"","pagination-position":"both","current-page":t.queryParams.page,"per-page":t.lists.perPage,total:t.lists.total,"backend-sorting":""},on:{"page-change":t.onPageChange,sort:t.onSort},scopedSlots:t._u([{key:"top-left",fn:function(){return[e("div",{staticClass:"columns"},[e("div",{staticClass:"column is-6"},[e("form",{on:{submit:function(s){return s.preventDefault(),t.getLists.apply(null,arguments)}}},[e("div",[e("b-field",[e("b-input",{ref:"query",attrs:{name:"query",expanded:"",icon:"magnify","data-cy":"query"},model:{value:t.queryParams.query,callback:function(s){t.$set(t.queryParams,"query",s)},expression:"queryParams.query"}}),e("p",{staticClass:"controls"},[e("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify","data-cy":"btn-query"}})],1)],1)],1)])])])]},proxy:!0},t.loading.listsFull?null:{key:"empty",fn:function(){return[e("empty-placeholder")]},proxy:!0}],null,!0)},[e("b-table-column",{attrs:{field:"name",label:t.$t("globals.fields.name"),"header-class":"cy-name",sortable:"",width:"25%",paginated:"","backend-pagination":"","pagination-position":"both","td-attrs":t.$utils.tdID},on:{"page-change":t.onPageChange},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[e("a",{attrs:{href:`/lists/${s.row.id}`},on:{click:function(i){return i.preventDefault(),t.showEditForm(s.row)}}},[t._v(" "+t._s(s.row.name)+" ")]),e("b-taglist",t._l(s.row.tags,function(i){return e("b-tag",{key:i,staticClass:"is-small"},[t._v(" "+t._s(i)+" ")])}),1)],1)]}}])}),e("b-table-column",{attrs:{field:"type",label:t.$t("globals.fields.type"),"header-class":"cy-type",sortable:"",width:"15%"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"tags"},[e("b-tag",{class:s.row.type,attrs:{"data-cy":`type-${s.row.type}`}},[t._v(" "+t._s(t.$t(`lists.types.${s.row.type}`))+" ")]),t._v(" "+t._s(" ")+" "),e("b-tag",{class:s.row.optin,attrs:{"data-cy":`optin-${s.row.optin}`}},[e("b-icon",{attrs:{icon:s.row.optin==="double"?"account-check-outline":"account-off-outline",size:"is-small"}}),t._v(" "+t._s(" ")+" "+t._s(t.$t(`lists.optins.${s.row.optin}`))+" ")],1),t._v(t._s(" ")+" "),s.row.optin==="double"?e("a",{staticClass:"is-size-7 send-optin",attrs:{href:"#","data-cy":"btn-send-optin-campaign"},on:{click:function(i){t.$utils.confirm(null,()=>t.createOptinCampaign(s.row))}}},[e("b-tooltip",{attrs:{label:t.$t("lists.sendOptinCampaign"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"rocket-launch-outline",size:"is-small"}}),t._v(" "+t._s(t.$t("lists.sendOptinCampaign"))+" ")],1)],1):t._e()],1)]}}])}),e("b-table-column",{attrs:{field:"subscriber_count",label:t.$t("globals.terms.subscribers"),"header-class":"cy-subscribers",numeric:"",sortable:"",centered:""},scopedSlots:t._u([{key:"default",fn:function(s){return[t.$can("subscribers:get_all","subscribers:get")?[e("router-link",{attrs:{to:`/subscribers/lists/${s.row.id}`}},[t._v(" "+t._s(t.$utils.formatNumber(s.row.subscriberCount))+" "),e("span",{staticClass:"is-size-7 view"},[t._v(t._s(t.$t("globals.buttons.view")))])])]:[t._v(" "+t._s(t.$utils.formatNumber(s.row.subscriberCount))+" ")]]}}])}),e("b-table-column",{attrs:{field:"subscriber_counts","header-class":"cy-subscribers",width:"10%"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",{staticClass:"fields stats"},t._l(t.filterStatuses(s.row),function(i,l){return e("p",{key:l},[e("label",{attrs:{for:"#"}},[t._v(t._s(t.$tc(`subscribers.status.${l}`,i)))]),e("router-link",{class:l,attrs:{to:`/subscribers/lists/${s.row.id}?subscription_status=${l}`}},[t._v(" "+t._s(t.$utils.formatNumber(i))+" ")])],1)}),0)]}}])}),e("b-table-column",{attrs:{field:"created_at",label:t.$t("globals.fields.createdAt"),"header-class":"cy-created_at",sortable:""},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v(" "+t._s(t.$utils.niceDate(s.row.createdAt))+" ")]}}])}),e("b-table-column",{attrs:{field:"updated_at",label:t.$t("globals.fields.updatedAt"),"header-class":"cy-updated_at",sortable:""},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v(" "+t._s(t.$utils.niceDate(s.row.updatedAt))+" ")]}}])}),e("b-table-column",{attrs:{"cell-class":"actions",align:"right"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("div",[t.$can("campaigns:manage")?e("router-link",{attrs:{to:`/campaigns/new?list_id=${s.row.id}`,"data-cy":"btn-campaign"}},[e("b-tooltip",{attrs:{label:t.$t("lists.sendCampaign"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"rocket-launch-outline",size:"is-small"}})],1)],1):t._e(),t.$can("lists:manage")||t.$canList(s.row.id,"list:manage")?e("a",{attrs:{href:"#","data-cy":"btn-edit","aria-label":t.$t("globals.buttons.edit")},on:{click:function(i){return i.preventDefault(),t.showEditForm(s.row)}}},[e("b-tooltip",{attrs:{label:t.$t("globals.buttons.edit"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"pencil-outline",size:"is-small"}})],1)],1):t._e(),t.$can("subscribers:import")?e("router-link",{attrs:{to:{name:"import",query:{list_id:s.row.id}},"data-cy":"btn-import"}},[e("b-tooltip",{attrs:{label:t.$t("import.title"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"file-upload-outline",size:"is-small"}})],1)],1):t._e(),t.$can("lists:manage")||t.$canList(s.row.id,"list:manage")?e("a",{attrs:{href:"#","data-cy":"btn-delete","aria-label":t.$t("globals.buttons.delete")},on:{click:function(i){return i.preventDefault(),t.deleteList(s.row)}}},[e("b-tooltip",{attrs:{label:t.$t("globals.buttons.delete"),type:"is-dark"}},[e("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1):t._e()],1)]}}])})],1),e("b-modal",{attrs:{scroll:"keep","aria-modal":!0,active:t.isFormVisible,width:600},on:{"update:active":function(s){t.isFormVisible=s},close:t.onFormClose}},[e("list-form",{attrs:{data:t.curItem,"is-editing":t.isEditing},on:{finished:t.formFinished}})],1),t.settings["app.cache_slow_queries"]?e("p",{staticClass:"has-text-grey"},[t._v(" *"+t._s(t.$t("globals.messages.slowQueriesCached"))+" "),e("a",{staticClass:"has-text-grey",attrs:{href:"https://listmonk.app/docs/maintenance/performance/",target:"_blank",rel:"noopener noreferer"}},[e("b-icon",{attrs:{icon:"link-variant"}}),t._v(" "+t._s(t.$t("globals.buttons.learnMore"))+" ")],1)]):t._e()],1)},_=[],y=o(g,h,_);const k=y.exports;export{k as default};
