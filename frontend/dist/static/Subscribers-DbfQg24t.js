import{V as r,m as n,n as u,u as b}from"./index-BCeMOe0T.js";import{E as d}from"./EmptyPlaceholder-C9_D_EHA.js";import{L as o}from"./ListSelector-IGEJSNAD.js";import{C as c}from"./CopyText-Da2spgK4.js";const m=r.extend({components:{ListSelector:o},props:{numSubscribers:{type:Number,default:0}},data(){return{form:{action:"add",lists:[],preconfirm:!1}}},methods:{onSubmit(){this.$emit("finished",this.form.action,this.form.preconfirm,this.form.lists),this.$parent.close()}},computed:{...n(["lists","loading"]),hasOptinList(){return this.form.lists.some(i=>i.optin==="double")}}});var h=function(){var t=this,s=t._self._c;return t._self._setupProxy,s("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[s("div",{staticClass:"modal-card",staticStyle:{width:"auto"}},[s("header",{staticClass:"modal-card-head"},[s("h4",{staticClass:"title is-size-5"},[t._v(" "+t._s(t.$t("subscribers.manageLists"))+" ")])]),s("section",{staticClass:"modal-card-body",attrs:{expanded:""}},[s("b-field",{attrs:{label:"Action"}},[s("div",[s("b-radio",{attrs:{name:"action","native-value":"add","data-cy":"check-list-add"},model:{value:t.form.action,callback:function(e){t.$set(t.form,"action",e)},expression:"form.action"}},[t._v(" "+t._s(t.$t("globals.buttons.add"))+" ")]),s("b-radio",{attrs:{name:"action","native-value":"remove","data-cy":"check-list-remove"},model:{value:t.form.action,callback:function(e){t.$set(t.form,"action",e)},expression:"form.action"}},[t._v(" "+t._s(t.$t("globals.buttons.remove"))+" ")]),s("b-radio",{attrs:{name:"action","native-value":"unsubscribe","data-cy":"check-list-unsubscribe"},model:{value:t.form.action,callback:function(e){t.$set(t.form,"action",e)},expression:"form.action"}},[t._v(" "+t._s(t.$t("subscribers.markUnsubscribed"))+" ")])],1)]),s("list-selector",{attrs:{label:"Target lists",placeholder:"Lists to apply to",selected:t.form.lists,all:t.lists.results},model:{value:t.form.lists,callback:function(e){t.$set(t.form,"lists",e)},expression:"form.lists"}}),s("b-field",{attrs:{message:t.$t("subscribers.preconfirmHelp")}},[s("b-checkbox",{attrs:{"data-cy":"preconfirm","native-value":!0,disabled:!t.hasOptinList},model:{value:t.form.preconfirm,callback:function(e){t.$set(t.form,"preconfirm",e)},expression:"form.preconfirm"}},[t._v(" "+t._s(t.$t("subscribers.preconfirm"))+" ")])],1)],1),s("footer",{staticClass:"modal-card-foot has-text-right"},[s("b-button",{on:{click:function(e){return t.$parent.close()}}},[t._v(" "+t._s(t.$t("globals.buttons.close"))+" ")]),s("b-button",{attrs:{"native-type":"submit",type:"is-primary",disabled:t.form.lists.length===0}},[t._v(" "+t._s(t.$t("globals.buttons.save"))+" ")])],1)])])},f=[],p=u(m,h,f);const y=p.exports,_=r.extend({components:{ListSelector:o,CopyText:c},props:{data:{type:Object,default:()=>({lists:[]})},isEditing:Boolean},data(){return{form:{lists:[],strAttribs:"{}",status:"enabled",preconfirm:!1},isBounceVisible:!1,bounces:[],visibleMeta:{},egAttribs:'{"job": "developer", "location": "Mars", "has_rocket": true}'}},methods:{toggleBounces(){this.isBounceVisible=!this.isBounceVisible},toggleMeta(i){let t=!1;this.visibleMeta[i]||(t=!0),r.set(this.visibleMeta,i,t)},deleteBounces(i){this.$utils.confirm(null,()=>{this.$api.deleteSubscriberBounces(this.form.id).then(()=>{this.getBounces(),this.$utils.toast(this.$t("globals.messages.deleted",{name:i.name}))})})},getBounces(){this.$api.getSubscriberBounces(this.form.id).then(i=>{this.bounces=i})},onSubmit(){if(this.isEditing){this.updateSubscriber();return}this.createSubscriber()},createSubscriber(){let i={};if(this.form.strAttribs&&(i=this.validateAttribs(this.form.strAttribs),!i))return;const t={email:this.form.email,name:this.form.name,status:this.form.status,attribs:i,preconfirm_subscriptions:this.form.preconfirm,lists:this.form.lists.map(s=>s.id)};this.$api.createSubscriber(t).then(s=>{this.$emit("finished"),this.$parent.close(),this.$utils.toast(this.$t("globals.messages.created",{name:s.name}))})},updateSubscriber(){let i={};if(this.form.strAttribs&&(i=this.validateAttribs(this.form.strAttribs),!i))return;const t={id:this.form.id,email:this.form.email,name:this.form.name,status:this.form.status,preconfirm_subscriptions:this.form.preconfirm,attribs:i,lists:this.form.lists.map(s=>s.id)};this.$api.updateSubscriber(t).then(s=>{this.$emit("finished"),this.$parent.close(),this.$utils.toast(this.$t("globals.messages.updated",{name:s.name}))})},sendOptinConfirmation(){this.$api.sendSubscriberOptin(this.form.id).then(()=>{this.$utils.toast(this.$t("subscribers.sentOptinConfirm"))})},validateAttribs(i){let t={};try{t=JSON.parse(i)}catch(s){return this.$utils.toast(`${this.$t("subscribers.invalidJSON")}: ${s.toString()}`,"is-danger",3e3),null}return t instanceof Array?(this.$utils.toast("Attributes should be a map {} and not an array []","is-danger",3e3),null):t}},computed:{...n(["lists","loading"]),hasOptinList(){return this.form.lists.some(i=>i.optin==="double")}},mounted(){this.$props.isEditing&&(this.form={...this.$props.data,strAttribs:JSON.stringify(this.$props.data.attribs,null,4)}),this.form.id&&this.getBounces(),this.$nextTick(()=>{this.$refs.focus.focus()})}});var g=function(){var t=this,s=t._self._c;return t._self._setupProxy,s("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[s("div",{staticClass:"modal-card content",staticStyle:{width:"auto"}},[s("header",{staticClass:"modal-card-head"},[t.isEditing?s("b-tag",{class:[t.data.status,"is-pulled-right"]},[t._v(" "+t._s(t.$t(`subscribers.status.${t.data.status}`))+" ")]):t._e(),t.isEditing?s("h4",[t._v(" "+t._s(t.data.name)+" ")]):s("h4",[t._v(" "+t._s(t.$t("subscribers.newSubscriber"))+" ")]),t.isEditing?s("p",{staticClass:"has-text-grey is-size-7"},[t._v(" "+t._s(t.$t("globals.fields.id"))+": "),s("span",{attrs:{"data-cy":"id"}},[s("copy-text",{attrs:{text:`${t.data.id}`}})],1),t._v(" "+t._s(t.$t("globals.fields.uuid"))+": "),s("copy-text",{attrs:{text:t.data.uuid}})],1):t._e()],1),s("section",{staticClass:"modal-card-body",attrs:{expanded:""}},[s("b-field",{attrs:{label:t.$t("subscribers.email"),"label-position":"on-border"}},[s("b-input",{ref:"focus",attrs:{maxlength:200,name:"email",placeholder:t.$t("subscribers.email"),required:""},model:{value:t.form.email,callback:function(e){t.$set(t.form,"email",e)},expression:"form.email"}})],1),s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-8"},[s("b-field",{attrs:{label:t.$t("globals.fields.name"),"label-position":"on-border"}},[s("b-input",{attrs:{maxlength:200,name:"name",placeholder:t.$t("globals.fields.name")},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),s("div",{staticClass:"column is-4"},[s("b-field",{attrs:{label:t.$t("globals.fields.status"),"label-position":"on-border",message:t.$t("subscribers.blocklistedHelp")}},[s("b-select",{attrs:{name:"status",placeholder:t.$t("globals.fields.status"),required:"",expanded:""},model:{value:t.form.status,callback:function(e){t.$set(t.form,"status",e)},expression:"form.status"}},[s("option",{attrs:{value:"enabled"}},[t._v(" "+t._s(t.$t("subscribers.status.enabled"))+" ")]),s("option",{attrs:{value:"blocklisted"}},[t._v(" "+t._s(t.$t("subscribers.status.blocklisted"))+" ")])])],1)],1)]),s("b-tabs",{attrs:{type:"is-boxed",animated:!1}},[s("b-tab-item",{attrs:{label:t.$t("globals.terms.lists"),"label-position":"on-border"}},[s("list-selector",{attrs:{label:t.$t("subscribers.lists"),placeholder:t.$t("subscribers.listsPlaceholder"),message:t.$t("subscribers.listsHelp"),selected:t.form.lists,all:t.lists.results},model:{value:t.form.lists,callback:function(e){t.$set(t.form,"lists",e)},expression:"form.lists"}}),s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-7"},[s("b-field",{attrs:{message:t.$t("subscribers.preconfirmHelp")}},[s("b-checkbox",{attrs:{"native-value":!0,disabled:!t.hasOptinList},model:{value:t.form.preconfirm,callback:function(e){t.$set(t.form,"preconfirm",e)},expression:"form.preconfirm"}},[t._v(" "+t._s(t.$t("subscribers.preconfirm"))+" ")])],1)],1),t.$can("subscribers:manage")&&t.isEditing?s("div",{staticClass:"column is-5 has-text-right"},[s("a",{class:{"is-disabled":!t.hasOptinList},attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.sendOptinConfirmation.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"email-outline",size:"is-small"}}),t._v(" "+t._s(t.$t("subscribers.sendOptinConfirm")))],1)]):t._e()])],1),s("b-tab-item",{attrs:{label:`${t.$tc("globals.terms.subscriptions",2)} (${t.data.lists?t.data.lists.length:0})`,"label-position":"on-border",disabled:!t.data.lists||t.data.lists.length===0}},[t.data.lists?[s("b-table",{staticClass:"subscriptions",attrs:{data:t.data.lists,hoverable:"","default-sort":"createdAt"}},[s("b-table-column",{attrs:{field:"name",label:t.$tc("globals.terms.list",1)},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[s("router-link",{attrs:{to:`/lists/${e.row.id}`}},[t._v(" "+t._s(e.row.name)+" ")]),s("br"),s("b-tag",{class:e.row.optin,attrs:{"data-cy":`optin-${e.row.optin}`}},[s("b-icon",{attrs:{icon:e.row.optin==="double"?"account-check-outline":"account-off-outline",size:"is-small"}}),t._v(" "+t._s(" ")+" "+t._s(t.$t(`lists.optins.${e.row.optin}`))+" ")],1),t._v(t._s(" ")+" ")],1)]}}],null,!1,1970113575)}),s("b-table-column",{attrs:{field:"status","cell-class":"status",label:t.$t("globals.fields.status")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("b-tag",{class:`status-${e.row.subscriptionStatus}`},[t._v(" "+t._s(t.$t(`subscribers.status.${e.row.subscriptionStatus}`))+" ")]),e.row.optin==="double"&&e.row.subscriptionMeta.optinIp?[s("br"),s("span",{staticClass:"is-size-7"},[t._v(t._s(e.row.subscriptionMeta.optinIp))])]:t._e()]}}],null,!1,683797244)}),s("b-table-column",{attrs:{field:"createdAt",label:t.$t("globals.fields.createdAt")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$utils.niceDate(e.row.subscriptionCreatedAt,!0))+" ")]}}],null,!1,329035960)}),s("b-table-column",{attrs:{field:"updatedAt",label:t.$t("globals.fields.updatedAt")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$utils.niceDate(e.row.subscriptionCreatedAt,!0))+" ")]}}],null,!1,329035960)})],1)]:t._e()],2),s("b-tab-item",{staticClass:"bounces",attrs:{label:`${t.$t("globals.terms.bounces")} (${t.bounces.length})`,disabled:t.bounces.length===0}},[t.isBounceVisible?s("a",{staticClass:"is-size-6 is-pulled-right",attrs:{href:"#",disabed:"true"},on:{click:function(e){return e.preventDefault(),t.deleteBounces.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"trash-can-outline"}}),t._v(" "+t._s(t.$t("globals.buttons.delete"))+" ")],1):t._e(),s("b-table",{staticClass:"bounces",attrs:{data:t.bounces,hoverable:"","default-sort":"createdAt"}},[s("b-table-column",{attrs:{field:"campaign",label:t.$tc("globals.terms.campaign",1)},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.campaign?s("div",[s("router-link",{attrs:{to:{name:"bounces",query:{campaign_id:e.row.campaign.id}}}},[t._v(" "+t._s(e.row.campaign.name)+" ")])],1):t._e()]}}])}),s("b-table-column",{attrs:{field:"createdAt",label:t.$t("globals.fields.createdAt")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$utils.niceDate(e.row.createdAt,!0))+" ")]}}])}),s("b-table-column",{attrs:{field:"action",label:t.$t("globals.fields.type")},scopedSlots:t._u([{key:"default",fn:function(e){return[s("span",{staticClass:"is-pulled-right"},[s("a",{attrs:{href:"#"},on:{click:function(a){return a.preventDefault(),t.toggleMeta(e.row.id)}}},[t._v(" "+t._s(e.row.source)+" "),s("b-icon",{attrs:{icon:t.visibleMeta[e.row.id]?"arrow-up":"arrow-down"}})],1)]),s("span",{staticClass:"is-clearfix"}),t.visibleMeta[e.row.id]?s("pre",[t._v(t._s(e.row.meta))]):t._e()]}}])})],1)],1)],1),s("b-field",{staticClass:"mt-6",attrs:{message:t.$t("subscribers.attribsHelp")+" "+t.egAttribs}},[s("div",[s("h5",[t._v(t._s(t.$t("subscribers.attribs")))]),s("b-input",{attrs:{name:"attribs",type:"textarea"},model:{value:t.form.strAttribs,callback:function(e){t.$set(t.form,"strAttribs",e)},expression:"form.strAttribs"}}),s("a",{staticClass:"is-size-7",attrs:{href:"https://listmonk.app/docs/concepts",target:"_blank",rel:"noopener noreferrer"}},[t._v(" "+t._s(t.$t("globals.buttons.learnMore"))+" "),s("b-icon",{attrs:{icon:"link-variant",size:"is-small"}})],1)],1)])],1),s("footer",{staticClass:"modal-card-foot has-text-right"},[s("b-button",{on:{click:function(e){return t.$parent.close()}}},[t._v(" "+t._s(t.$t("globals.buttons.close"))+" ")]),t.$can("subscribers:manage")?s("b-button",{attrs:{"native-type":"submit",type:"is-primary",loading:t.loading.subscribers}},[t._v(" "+t._s(t.$t("globals.buttons.save"))+" ")]):t._e()],1)])])},$=[],v=u(_,g,$);const k=v.exports,S=r.extend({components:{SubscriberForm:k,SubscriberBulkList:y,CopyText:c,EmptyPlaceholder:d},data(){return{curItem:null,isSearchAdvanced:!1,isEditing:!1,isFormVisible:!1,isBulkListFormVisible:!1,bulk:{checked:[],all:!1},queryInput:"",queryParams:{queryExp:"",search:"",listID:null,page:1,orderBy:"id",order:"desc",subStatus:null}}},methods:{listCount(i){return i.reduce((t,s)=>t+(s.subscriptionStatus!=="unsubscribed"?1:0),0)},toggleAdvancedSearch(){if(this.isSearchAdvanced=!this.isSearchAdvanced,this.queryParams.search="",!this.isSearchAdvanced){this.queryInput="",this.queryParams.queryExp="",this.queryParams.page=1,this.querySubscribers(),this.$refs.query.focus();return}const i=this.queryInput.replace(/'/,"''").trim();i&&(this.$utils.validateEmail(i)?this.queryParams.queryExp=`email = '${i.toLowerCase()}'`:this.queryParams.queryExp=`(name ~* '${i}' OR email ~* '${i.toLowerCase()}')`),this.$nextTick(()=>{this.$refs.queryExp.focus()})},selectAllSubscribers(){this.bulk.all=!0},onTableCheck(){this.bulk.checked.length!==this.subscribers.total&&(this.bulk.all=!1)},showEditForm(i){this.curItem=i,this.isFormVisible=!0,this.isEditing=!0},showNewForm(){this.curItem={},this.isFormVisible=!0,this.isEditing=!1},showBulkListForm(){this.isBulkListFormVisible=!0},onFormClose(){this.$route.params.id&&this.$router.push({name:"subscribers"})},onPageChange(i){this.querySubscribers({page:i})},onSort(i,t){this.querySubscribers({orderBy:i,order:t})},onSimpleQueryInput(i){const t=i.replace(/'/,"''").trim();this.queryParams.queryExp="",this.queryParams.page=1,this.queryParams.search=t.toLowerCase()},onAdvancedQueryEnter(i){i.ctrlKey&&this.onSubmit()},onSubmit(){this.querySubscribers({page:1})},querySubscribers(i){this.queryParams={...this.queryParams,...i};const t={list_id:this.queryParams.listID,search:this.queryParams.search,query:this.queryParams.queryExp,page:this.queryParams.page,subscription_status:this.queryParams.subStatus,order_by:this.queryParams.orderBy,order:this.queryParams.order};this.queryParams.queryExp?delete t.search:delete t.queryExp,this.$nextTick(()=>{this.$api.getSubscribers(t).then(()=>{this.bulk.checked=[]})})},deleteSubscriber(i){this.$utils.confirm(null,()=>{this.$api.deleteSubscriber(i.id).then(()=>{this.querySubscribers(),this.$utils.toast(this.$t("globals.messages.deleted",{name:i.name}))})})},blocklistSubscribers(){let i=null;!this.bulk.all&&this.bulk.checked.length>0?i=()=>{const t=this.bulk.checked.map(s=>s.id);this.$api.blocklistSubscribers({ids:t}).then(()=>this.querySubscribers())}:i=()=>{this.$api.blocklistSubscribersByQuery({search:this.queryParams.search,query:this.queryParams.queryExp,list_ids:this.queryParams.listID?[this.queryParams.listID]:null,subscription_status:this.queryParams.subStatus}).then(()=>this.querySubscribers())},this.$utils.confirm(this.$t("subscribers.confirmBlocklist",{num:this.numSelectedSubscribers}),i)},exportSubscribers(){const i=!this.bulk.all&&this.bulk.checked.length>0?this.bulk.checked.length:this.subscribers.total;this.$utils.confirm(this.$t("subscribers.confirmExport",{num:i}),()=>{const t=new URLSearchParams;this.queryParams.search?t.append("search",this.queryParams.search):this.queryParams.queryExp&&t.append("query",this.queryParams.queryExp),this.queryParams.listID&&t.append("list_id",this.queryParams.listID),this.queryParams.subStatus&&t.append("subscription_status",this.queryParams.subStatus),!this.bulk.all&&this.bulk.checked.length>0&&this.bulk.checked.map(s=>t.append("id",s.id)),document.location.href=`${b.exportSubscribers}?${t.toString()}`})},deleteSubscribers(){let i=null;!this.bulk.all&&this.bulk.checked.length>0?i=()=>{const t=this.bulk.checked.map(s=>s.id);this.$api.deleteSubscribers({id:t}).then(()=>{this.querySubscribers(),this.$utils.toast(this.$t("subscribers.subscribersDeleted",{num:this.numSelectedSubscribers}))})}:i=()=>{this.$api.deleteSubscribersByQuery({all:this.queryParams.queryExp.trim()===""&&this.queryParams.search.trim()==="",search:this.queryParams.search,query:this.queryParams.queryExp,list_ids:this.queryParams.listID?[this.queryParams.listID]:null,subscription_status:this.queryParams.subStatus}).then(()=>{this.querySubscribers(),this.$utils.toast(this.$t("subscribers.subscribersDeleted",{num:this.numSelectedSubscribers}))})},this.$utils.confirm(this.$t("subscribers.confirmDelete",{num:this.numSelectedSubscribers}),i)},bulkChangeLists(i,t,s){const e={action:i,query:this.fullQueryExp,search:this.queryParams.search,list_ids:this.queryParams.listID?[this.queryParams.listID]:null,target_list_ids:s.map(l=>l.id)};t&&(e.status="confirmed");let a=null;!this.bulk.all&&this.bulk.checked.length>0?(a=this.$api.addSubscribersToLists,e.ids=this.bulk.checked.map(l=>l.id)):(e.query=this.queryParams.queryExp,e.subscription_status=this.queryParams.subStatus,a=this.$api.addSubscribersToListsByQuery),a(e).then(()=>{this.querySubscribers(),this.$utils.toast(this.$t("subscribers.listChangeApplied"))})}},computed:{...n(["subscribers","lists","loading"]),numSelectedSubscribers(){return this.bulk.all?this.subscribers.total:this.bulk.checked.length},currentList(){return!this.queryParams.listID||!this.lists.results?null:this.lists.results.find(i=>i.id===this.queryParams.listID)}},mounted(){this.$route.params.listID&&(this.queryParams.listID=parseInt(this.$route.params.listID,10)),this.$route.query.subscription_status&&(this.queryParams.subStatus=this.$route.query.subscription_status),this.$route.params.id?this.$api.getSubscriber(parseInt(this.$route.params.id,10)).then(i=>{this.showEditForm(i)}):this.querySubscribers()}});var q=function(){var t=this,s=t._self._c;return t._self._setupProxy,s("section",{staticClass:"subscribers"},[s("header",{staticClass:"columns page-header"},[s("div",{staticClass:"column is-10"},[s("h1",{staticClass:"title is-4"},[t._v(" "+t._s(t.$t("globals.terms.subscribers"))+" "),isNaN(t.subscribers.total)?t._e():s("span",[t._v(" ("),s("span",{attrs:{"data-cy":"count"}},[t._v(t._s(t.subscribers.total))]),t._v(") ")]),t.currentList?s("span",[t._v(" » "+t._s(t.currentList.name)+" "),t.queryParams.subStatus?s("span",{staticClass:"has-text-grey has-text-weight-normal is-capitalized"},[t._v("("+t._s(t.queryParams.subStatus)+")")]):t._e()]):t._e()])]),s("div",{staticClass:"column has-text-right"},[t.$can("subscribers:manage")?s("b-field",{attrs:{expanded:""}},[s("b-button",{staticClass:"btn-new",attrs:{expanded:"",type:"is-primary","icon-left":"plus","data-cy":"btn-new"},on:{click:t.showNewForm}},[t._v(" "+t._s(t.$t("globals.buttons.new"))+" ")])],1):t._e()],1)]),s("section",{staticClass:"subscribers-controls"},[s("div",{staticClass:"columns"},[s("div",{staticClass:"column is-8"},[s("form",{on:{submit:function(e){return e.preventDefault(),t.onSubmit.apply(null,arguments)}}},[s("div",[s("b-field",{attrs:{addons:""}},[s("b-input",{ref:"query",attrs:{expanded:"",placeholder:t.$t("subscribers.queryPlaceholder"),icon:"magnify",disabled:t.isSearchAdvanced,"data-cy":"search"},on:{input:t.onSimpleQueryInput},model:{value:t.queryInput,callback:function(e){t.queryInput=e},expression:"queryInput"}}),s("p",{staticClass:"controls"},[s("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify",disabled:t.isSearchAdvanced,"data-cy":"btn-search"}})],1)],1),t.isSearchAdvanced?s("div",[s("b-input",{ref:"queryExp",attrs:{type:"textarea",placeholder:"subscribers.name LIKE '%user%' or subscribers.status='blocklisted'","data-cy":"query"},nativeOn:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onAdvancedQueryEnter.apply(null,arguments)}},model:{value:t.queryParams.queryExp,callback:function(e){t.$set(t.queryParams,"queryExp",e)},expression:"queryParams.queryExp"}}),s("span",{staticClass:"is-size-6 has-text-grey"},[t._v(" "+t._s(t.$t("subscribers.advancedQueryHelp"))+"."+t._s(" ")+" "),s("a",{attrs:{href:"https://listmonk.app/docs/querying-and-segmentation",target:"_blank",rel:"noopener noreferrer"}},[t._v(" "+t._s(t.$t("globals.buttons.learnMore"))+". ")])]),s("div",{staticClass:"buttons"},[s("b-button",{attrs:{"native-type":"submit",type:"is-primary","icon-left":"magnify","data-cy":"btn-query"}},[t._v(" "+t._s(t.$t("subscribers.query"))+" ")]),s("b-button",{attrs:{"icon-left":"cancel","data-cy":"btn-query-reset"},on:{click:function(e){return e.preventDefault(),t.toggleAdvancedSearch.apply(null,arguments)}}},[t._v(" "+t._s(t.$t("subscribers.reset"))+" ")])],1)],1):t._e()],1)]),t.isSearchAdvanced?t._e():s("div",{staticClass:"toggle-advanced"},[s("a",{attrs:{href:"#","data-cy":"btn-advanced-search"},on:{click:function(e){return e.preventDefault(),t.toggleAdvancedSearch.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"cog-outline",size:"is-small"}}),t._v(" "+t._s(t.$t("subscribers.advancedQuery"))+" ")],1)])])])]),s("br"),s("b-table",{attrs:{data:t.subscribers.results??[],loading:t.loading.subscribers,"checked-rows":t.bulk.checked,paginated:"","backend-pagination":"","pagination-position":"both","current-page":t.queryParams.page,"per-page":t.subscribers.perPage,total:t.subscribers.total,hoverable:"",checkable:"","backend-sorting":""},on:{"check-all":t.onTableCheck,check:t.onTableCheck,"update:checkedRows":function(e){return t.$set(t.bulk,"checked",e)},"update:checked-rows":function(e){return t.$set(t.bulk,"checked",e)},"page-change":t.onPageChange,sort:t.onSort},scopedSlots:t._u([{key:"top-left",fn:function(){return[s("div",{staticClass:"actions"},[s("a",{staticClass:"a",attrs:{href:"#","data-cy":"btn-export-subscribers"},on:{click:function(e){return e.preventDefault(),t.exportSubscribers.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"cloud-download-outline",size:"is-small"}}),t._v(" "+t._s(t.$t("subscribers.export"))+" ")],1),t.bulk.checked.length>0?[s("a",{staticClass:"a",attrs:{href:"#","data-cy":"btn-manage-lists"},on:{click:function(e){return e.preventDefault(),t.showBulkListForm.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"format-list-bulleted-square",size:"is-small"}}),t._v(" Manage lists ")],1),s("a",{staticClass:"a",attrs:{href:"#","data-cy":"btn-delete-subscribers"},on:{click:function(e){return e.preventDefault(),t.deleteSubscribers.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}}),t._v(" Delete ")],1),s("a",{staticClass:"a",attrs:{href:"#","data-cy":"btn-manage-blocklist"},on:{click:function(e){return e.preventDefault(),t.blocklistSubscribers.apply(null,arguments)}}},[s("b-icon",{attrs:{icon:"account-off-outline",size:"is-small"}}),t._v(" Blocklist ")],1),s("span",{staticClass:"a"},[t._v(" "+t._s(t.$t("subscribers.numSelected",{num:t.numSelectedSubscribers}))+" "),!t.bulk.all&&t.subscribers.total>t.subscribers.perPage?s("span",[t._v(" — "),s("a",{attrs:{href:"#"},on:{click:function(e){return e.preventDefault(),t.selectAllSubscribers.apply(null,arguments)}}},[t._v(" "+t._s(t.$t("subscribers.selectAll",{num:t.subscribers.total}))+" ")])]):t._e()])]:t._e()],2)]},proxy:!0},t.loading.subscribers?null:{key:"empty",fn:function(){return[s("empty-placeholder")]},proxy:!0}],null,!0)},[s("b-table-column",{attrs:{field:"email",label:t.$t("subscribers.email"),"header-class":"cy-email",sortable:"","td-attrs":t.$utils.tdID},scopedSlots:t._u([{key:"default",fn:function(e){return[s("a",{class:{blocklisted:e.row.status==="blocklisted"},attrs:{href:`/subscribers/${e.row.id}`},on:{click:function(a){return a.preventDefault(),t.showEditForm(e.row)}}},[t._v(" "+t._s(e.row.email)+" "),s("copy-text",{attrs:{text:`${e.row.email}`,"hide-text":""}})],1),e.row.status!=="enabled"?s("b-tag",{class:e.row.status,attrs:{"data-cy":"blocklisted"}},[t._v(" "+t._s(t.$t(`subscribers.status.${e.row.status}`))+" ")]):t._e(),s("b-taglist",[t._l(e.row.lists,function(a){return[s("router-link",{key:a.id,staticStyle:{"padding-right":"0.5em"},attrs:{to:`/subscribers/lists/${a.id}`}},[s("b-tag",{key:a.id,class:a.subscriptionStatus,attrs:{size:"is-small"}},[t._v(" "+t._s(a.name)+" "),a.optin==="double"||a.subscriptionStatus=="unsubscribed"?s("sup",[t._v(" "+t._s(t.$t(`subscribers.status.${a.subscriptionStatus}`))+" ")]):t._e()])],1)]})],2)]}}])}),s("b-table-column",{attrs:{field:"name",label:t.$t("globals.fields.name"),"header-class":"cy-name",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[s("a",{class:{blocklisted:e.row.status==="blocklisted"},attrs:{href:`/subscribers/${e.row.id}`},on:{click:function(a){return a.preventDefault(),t.showEditForm(e.row)}}},[t._v(" "+t._s(e.row.name)+" "),s("copy-text",{attrs:{text:`${e.row.name}`,"hide-text":""}})],1)]}}])}),s("b-table-column",{attrs:{field:"lists",label:t.$t("globals.terms.lists"),"header-class":"cy-lists",centered:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.listCount(e.row.lists))+" ")]}}])}),s("b-table-column",{attrs:{field:"created_at",label:t.$t("globals.fields.createdAt"),"header-class":"cy-created_at",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$utils.niceDate(e.row.createdAt))+" ")]}}])}),s("b-table-column",{attrs:{field:"updated_at",label:t.$t("globals.fields.updatedAt"),"header-class":"cy-updated_at",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.$utils.niceDate(e.row.updatedAt))+" ")]}}])}),s("b-table-column",{attrs:{"cell-class":"actions",align:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("div",[s("a",{attrs:{href:`/api/subscribers/${e.row.id}/export`,"data-cy":"btn-download","aria-label":t.$t("subscribers.downloadData")}},[s("b-tooltip",{attrs:{label:t.$t("subscribers.downloadData"),type:"is-dark"}},[s("b-icon",{attrs:{icon:"cloud-download-outline",size:"is-small"}})],1)],1),t.$can("subscribers:manage")?s("a",{attrs:{href:`/subscribers/${e.row.id}`,"data-cy":"btn-edit","aria-label":t.$t("globals.buttons.edit")},on:{click:function(a){return a.preventDefault(),t.showEditForm(e.row)}}},[s("b-tooltip",{attrs:{label:t.$t("globals.buttons.edit"),type:"is-dark"}},[s("b-icon",{attrs:{icon:"pencil-outline",size:"is-small"}})],1)],1):t._e(),t.$can("subscribers:manage")?s("a",{attrs:{href:"#","data-cy":"btn-delete","aria-label":t.$t("globals.buttons.delete")},on:{click:function(a){return a.preventDefault(),t.deleteSubscriber(e.row)}}},[s("b-tooltip",{attrs:{label:t.$t("globals.buttons.delete"),type:"is-dark"}},[s("b-icon",{attrs:{icon:"trash-can-outline",size:"is-small"}})],1)],1):t._e()])]}}])})],1),s("b-modal",{staticClass:"has-overflow",attrs:{scroll:"keep","aria-modal":!0,active:t.isBulkListFormVisible,width:500},on:{"update:active":function(e){t.isBulkListFormVisible=e}}},[s("subscriber-bulk-list",{attrs:{"num-subscribers":this.numSelectedSubscribers},on:{finished:t.bulkChangeLists}})],1),s("b-modal",{attrs:{scroll:"keep","aria-modal":!0,active:t.isFormVisible,width:850},on:{"update:active":function(e){t.isFormVisible=e},close:t.onFormClose}},[s("subscriber-form",{attrs:{data:t.curItem,"is-editing":t.isEditing},on:{finished:t.querySubscribers}})],1)],1)},x=[],w=u(S,q,x);const E=w.exports;export{E as default};
